<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <link rel="stylesheet" href="style.css">



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
   


    <title>Cadastro!</title>
  </head>
  <body id="corpo">
    <div class="container">
      <div id="form-cadastro">
        <h1 class="texts">Cadastre-se!</h1>
        <label class="labels">USUARIO</label>
        <br>
        <input id="user" class="inps" type="text">
        <br>
        <label class="labels">E-MAIL</label>
        <br>
        <input required id="ema" class="inps" type="email">
        <br>
        <label class="labels">SENHA</label>
        <br>
        <input id="pass" class="inps" type="password">
        <br>
        <br>
        <button onclick="cadastrar()" id="btn-cadastro" class="btn btn-dark">CADASTRAR</button>
        <br>
        <br>
        <p id="msg"></p>
        <p id="para_l">ja tem uma conta? faça login abaixo</p>
    </div>
    

      <div id="form-login">
        <h1 class="texts">Faça o Login!!</h2>
      
        <label class="labels">E-MAIL</label>
        <br>
        <input id="ema-login" class="inps" type="email">
        <br>
        <label class="labels">SENHA</label>
        <br>
        <input id="pass-login" class="inps" type="password">
        <br>
        <br>
        <button onclick="gera_token()" id="btn-token" class="btn btn-dark">GERAR TOKEN DE ACESSO</button>
        <br>
        <br>
        <p id="msg-login"></p>
        <label class="labels">TOKEN</label>
        <br>
        <input id="token-login" class="inps" type="text">
        <br>
        <br>
        <button onclick="login()" id="btn-login" class="btn btn-dark">LOGIN</button>
        <br>
        <br>
        <p id="msg-token">

        </p>
      </div>
  </div>




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" ></script>



    <script>
      
      
      function cadastrar(){

        var usuario = document.getElementById('user').value;
        var email = document.getElementById('ema').value;
        var senha = document.getElementById('pass').value;

        var retorno = document.getElementById("msg");


        $.ajax({
          url:'http://127.0.0.1:5000/cadastro?user=' + usuario + '&email=' + email + '&senha=' + senha,
          method: 'post',
          success: function(resposta){
          console.log(resposta);
          if (resposta['erro'] == 0){
              var msg_retorno = '<div class="alert alert-success" role="alert"> Cadastro realizado com sucesso! </div>';
              retorno.innerHTML = msg_retorno;

            }else if (resposta['erro'] == 1){
              var msg_retorno = '<div class="alert alert-danger" role="alert"> A senha deve ser maior que 5 caracteres! </div>';
              retorno.innerHTML = msg_retorno;

            } else if (resposta['erro'] == 2){
              var msg_retorno = '<div class="alert alert-primary" role="alert"> Usuario ja cadastrado! </div>';
              retorno.innerHTML = msg_retorno;

            }else if (resposta['erro'] == 4){
              var msg_retorno = '<div class="alert alert-dark" role="alert"> Todos os campos obrigatorios! </div>';
              retorno.innerHTML = msg_retorno;
            
            }else if (resposta['erro'] == 5){
              var msg_retorno = '<div class="alert alert-secondary" role="alert"> Email invalido! </div>';
              retorno.innerHTML = msg_retorno;
            
            }else{
              msg_retorno = '<div class="alert alert-warning" role="alert"> Erro interno do sistema! </div>';
              retorno.innerHTML = msg_retorno;
            }
            
          },
        })
        
        


      }

      function gera_token(){

        var email_l = document.getElementById('ema-login').value;
        var senha_l = document.getElementById('pass-login').value;

        var retorno_login = document.getElementById('msg-login');


        $.ajax({
          url: 'http://127.0.0.1:5000/login?email=' + email_l + '&senha=' + senha_l,
          method: 'post',
          success: function(resposta){
            console.log(resposta)  
            if (resposta['erro'] == 1){
              var msg_retorno_login_e = '<div class="alert alert-danger" role="alert"> E-mail invalido! </div>';
              retorno_login.innerHTML = msg_retorno_login_e;

           }else if (resposta['erro'] == 2){
              var msg_retorno_login_ss = '<div class="alert alert-primary" role="alert"> Senha invalida! </div>';
               retorno_login.innerHTML = msg_retorno_login_ss;
              
            }else if (resposta['erro'] == 4){
              var msg_retorno = '<div class="alert alert-dark" role="alert"> Todos os campos obrigatorios! </div>';
              retorno_login.innerHTML = msg_retorno;
            
            }else{
              var msg_retorno_login_sss = '<div class="alert alert-warning" role="alert">Token gerado!!! Token valido por 3 minutos! </div>';
              retorno_login.innerHTML = msg_retorno_login_sss;
              localStorage.token = resposta['token']
              
              var token_gerado = document.getElementById('token-login')
              token_gerado.value = localStorage.token
            }

          }
        })
      }

      function login(){

        var token = document.getElementById('token-login').value
        var msg_token = document.getElementById('msg-token')

        $.ajax({
          url: 'http://127.0.0.1:5000/validaToken?token=' + token,
          method: 'post',
          success: function(resposta){
            console.log(resposta)
            if (resposta['erro'] == 0){
              token_msg = '<div class="alert alert-success" role="alert">Login realizado com Sucesso! </div>'
              msg_token.innerHTML = token_msg
            
            }else if (resposta['erro'] == 1){
              token_msg = '<div class="alert alert-danger" role="alert"> Token expirado, gere outro token! </div>'
              msg_token.innerHTML = token_msg
            
            }else if(resposta['erro'] == 4){
              token_msg = '<div class="alert alert-dark" role="alert"> Todos os campos obrigatorios! </div>'
              msg_token.innerHTML = token_msg
            
            }else{
              token_msg = '<div class="alert alert-dark" role="warning"> ERRO interno do sistema! </div>'
              msg_token.innerHTML = token_msg
            }


          }

        })
      }

  </script>


    
  </body>
</html>